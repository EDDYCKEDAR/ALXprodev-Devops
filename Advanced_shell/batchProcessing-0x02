#!/bin/bash
# Fetch multiple Pokémon with retries

POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
API_URL="https://pokeapi.co/api/v2/pokemon"
OUT_DIR="pokemon_data"
MAX_RETRIES=3

mkdir -p "$OUT_DIR"

for POKEMON in "${POKEMONS[@]}"; do
    echo "Fetching data for $POKEMON..."
    ATTEMPT=1
    SUCCESS=false

    while [ $ATTEMPT -le $MAX_RETRIES ]; do
        if curl -s -f "$API_URL/$POKEMON" -o "$OUT_DIR/${POKEMON}.json"; then
            echo "Saved data to $OUT_DIR/${POKEMON}.json ✅"
            SUCCESS=true
            break
        else
            echo "Attempt $ATTEMPT failed for $POKEMON"
            ((ATTEMPT++))
            sleep 2
        fi
    done

    if [ "$SUCCESS" = false ]; then
        echo "[$(date)] Failed to fetch $POKEMON after $MAX_RETRIES attempts" >> errors.txt
    fi
    sleep 1
done
